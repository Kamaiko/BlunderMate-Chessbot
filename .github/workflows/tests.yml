name: Prolog Chess Tests

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  test-suite:
    name: "Complete Test Suite"
    runs-on: ubuntu-latest
    container: swipl:latest
    timeout-minutes: 10

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      timeout-minutes: 2

    - name: Verify SWI-Prolog
      timeout-minutes: 1
      run: |
        echo "=== SWI-Prolog Verification ==="
        swipl --version

    - name: Run Foundation Tests
      timeout-minutes: 2
      run: |
        echo "=== Foundation Tests ==="
        timeout 90s swipl -s tests/tests.pl -g "run_foundation_tests, halt."

    - name: Run Game Rules Tests
      timeout-minutes: 2
      run: |
        echo "=== Game Rules Tests ==="
        timeout 90s swipl -s tests/tests.pl -g "run_game_rules_tests, halt."

    - name: Run AI Algorithm Tests
      timeout-minutes: 3
      run: |
        echo "=== AI Algorithm Tests ==="
        timeout 150s swipl -s tests/tests.pl -g "run_ai_algorithm_tests, halt."

    - name: Run Complete Test Suite
      timeout-minutes: 2
      run: |
        echo "=== Complete Test Suite ==="
        timeout 90s swipl -s tests/tests.pl -g "run_tests, halt."

    - name: Test Module Loading
      timeout-minutes: 1
      run: |
        echo "=== Module Loading Test ==="
        timeout 30s swipl -s src/interface.pl -g "write('Modules loaded successfully'), nl, halt(0)"

    - name: Performance Check
      if: always()
      run: |
        echo "=== Performance Metrics ==="
        echo "Pipeline completed at: $(date)"
        echo "Memory usage:"
        free -h || echo "Memory info unavailable"
name: Prolog Chess Tests

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install SWI-Prolog
      run: |
        sudo apt-get update
        sudo apt-get install -y swi-prolog

    - name: Verify SWI-Prolog installation
      run: swipl --version

    - name: Run Chess Tests
      run: |
        cd ${{ github.workspace }}
        swipl -s tests/tests.pl -g "run_tests, halt."

    - name: Run Foundation Tests
      run: swipl -s tests/tests.pl -g "run_foundation_tests, halt."

    - name: Run Pieces Tests
      run: swipl -s tests/tests.pl -g "run_pieces_tests, halt."

    - name: Run Checkmate Tests
      run: swipl -s tests/tests.pl -g "run_checkmate_tests, halt."

    - name: Run Robustness Tests
      run: swipl -s tests/tests.pl -g "run_robustness_tests, halt."

    - name: Run Integration Tests
      run: swipl -s tests/tests.pl -g "run_integration_tests, halt."

    - name: Run PSQT Tests
      run: swipl -s tests/tests.pl -g "run_psqt_tests, halt."

    - name: Run Alpha-Beta Tests
      run: swipl -s tests/tests.pl -g "run_alpha_beta_tests, halt."

    - name: Test Game Launch
      run: |
        timeout 10s swipl -s go.pl -g "write('Game launches successfully'), halt." || echo "Game launch test completed"
name: Prolog Chess Tests

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  test:
    runs-on: ubuntu-latest
    container: swipl:latest  # Image Docker officielle SWI-Prolog (~30s vs 2-3min)

    steps:
    - uses: actions/checkout@v4

    - name: Verify SWI-Prolog installation
      run: swipl --version

    - name: Run Chess Tests
      run: |
        cd ${{ github.workspace }}
        swipl -s tests/tests.pl -g "run_tests, halt."

    - name: Run Foundation Tests
      run: swipl -s tests/tests.pl -g "run_foundation_tests, halt."

    - name: Run Game Rules Tests
      run: swipl -s tests/tests.pl -g "run_game_rules_tests, halt."

    - name: Run AI Algorithm Tests
      run: swipl -s tests/tests.pl -g "run_ai_algorithm_tests, halt."

    - name: Run AI Evaluation Tests
      run: swipl -s tests/tests.pl -g "run_ai_evaluation_tests, halt."

    - name: Run Tactical Tests
      run: swipl -s tests/tests.pl -g "run_tactical_tests, halt."

    - name: Run Robustness Tests
      run: swipl -s tests/tests.pl -g "run_robustness_tests, halt."

    - name: Run Integration Tests
      run: swipl -s tests/tests.pl -g "run_integration_tests, halt."

    - name: Test Game Launch
      run: |
        timeout 10s swipl -s go.pl -g "write('Game launches successfully'), halt." || echo "Game launch test completed"